{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/davidvega/code/webstarter/client/store/users/AuthContext.jsx\";\nimport React, { useContext, useState, useEffect, createContext } from 'react';\nimport PropTypes from 'prop-types';\nimport { firebase, googleProvider } from '../../authentication/firebase';\nimport { postURL } from '../../api/PostURL';\nconst AuthContext = /*#__PURE__*/createContext();\nexport function useAuth() {\n  return useContext(AuthContext);\n} // https://www.youtube.com/watch?v=qWy9ylc3f9U\n\nexport function AuthProvider({\n  children\n}) {\n  const {\n    0: currentUser,\n    1: setCurrentUser\n  } = useState();\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(true);\n  const {\n    0: token,\n    1: setToken\n  } = useState(''); // this a global API with auth token baked in - this way we can track the user\n  // this is going to add a user to firebase auth as well as use the credential or uid created by firebase auth to\n  // add the user to firestore. The postURL function acts as a form of frontend middleware (maybe?) between the\n  // frontend and backend.\n\n  async function signup(uname, uemail, password) {\n    return firebase.createUserWithEmailAndPassword(uemail, password).then(cred => postURL('/api/users', {\n      uid: cred.user.uid,\n      username: uname,\n      email: uemail\n    }));\n  }\n\n  function login(email, password) {\n    return auth.signInWithEmailAndPassword(email, password);\n  }\n\n  async function loginWithGoogle() {\n    return auth.signInWithPopup(googleProvider).then(cred => {\n      postURL('/api/users', {\n        uid: cred.user.uid,\n        username: cred.user.displayName,\n        email: cred.user.email,\n        picture: cred.user.photoURL\n      });\n    });\n  }\n\n  function logout() {\n    return auth.signOut();\n  }\n\n  function resetPassword(email) {\n    return auth.sendPasswordResetEmail(email);\n  }\n\n  function updateEmail(email) {\n    return currentUser.updateEmail(email);\n  }\n\n  function updatePassword(password) {\n    return currentUser.updatePassword(password);\n  }\n\n  useEffect(() => {\n    auth.onAuthStateChanged(async user => {\n      if (user) {\n        const newToken = await user.getIdToken();\n        setToken(newToken);\n      } else {\n        setToken('');\n      }\n\n      setCurrentUser(user);\n      setLoading(false);\n    });\n  }, []);\n  const value = {\n    currentUser,\n    login,\n    loginWithGoogle,\n    signup,\n    logout,\n    resetPassword,\n    updateEmail,\n    updatePassword,\n    token\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: !loading && children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 10\n  }, this);\n}\nAuthProvider.propTypes = {\n  children: PropTypes.node.isRequired\n};","map":{"version":3,"sources":["/Users/davidvega/code/webstarter/client/store/users/AuthContext.jsx"],"names":["React","useContext","useState","useEffect","createContext","PropTypes","firebase","googleProvider","postURL","AuthContext","useAuth","AuthProvider","children","currentUser","setCurrentUser","loading","setLoading","token","setToken","signup","uname","uemail","password","createUserWithEmailAndPassword","then","cred","uid","user","username","email","login","auth","signInWithEmailAndPassword","loginWithGoogle","signInWithPopup","displayName","picture","photoURL","logout","signOut","resetPassword","sendPasswordResetEmail","updateEmail","updatePassword","onAuthStateChanged","newToken","getIdToken","value","propTypes","node","isRequired"],"mappings":"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","sourcesContent":["import React, { useContext, useState, useEffect, createContext } from 'react';\nimport PropTypes from 'prop-types';\nimport { firebase, googleProvider } from '../../authentication/firebase';\nimport { postURL } from '../../api/PostURL';\n\nconst AuthContext = createContext();\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n\n// https://www.youtube.com/watch?v=qWy9ylc3f9U\nexport function AuthProvider({ children }) {\n  const [currentUser, setCurrentUser] = useState();\n  const [loading, setLoading] = useState(true);\n  const [token, setToken] = useState('');\n\n  // this a global API with auth token baked in - this way we can track the user\n  // this is going to add a user to firebase auth as well as use the credential or uid created by firebase auth to\n  // add the user to firestore. The postURL function acts as a form of frontend middleware (maybe?) between the\n  // frontend and backend.\n  async function signup(uname, uemail, password) {\n    return firebase.createUserWithEmailAndPassword(uemail, password).then((cred) =>\n      postURL('/api/users', {\n        uid: cred.user.uid,\n        username: uname,\n        email: uemail,\n      }),\n    );\n  }\n\n  function login(email, password) {\n    return auth.signInWithEmailAndPassword(email, password);\n  }\n\n  async function loginWithGoogle() {\n    return auth.signInWithPopup(googleProvider).then((cred) => {\n      postURL('/api/users', {\n        uid: cred.user.uid,\n        username: cred.user.displayName,\n        email: cred.user.email,\n        picture: cred.user.photoURL,\n      });\n    });\n  }\n\n  function logout() {\n    return auth.signOut();\n  }\n\n  function resetPassword(email) {\n    return auth.sendPasswordResetEmail(email);\n  }\n\n  function updateEmail(email) {\n    return currentUser.updateEmail(email);\n  }\n\n  function updatePassword(password) {\n    return currentUser.updatePassword(password);\n  }\n\n  useEffect(() => {\n    auth.onAuthStateChanged(async (user) => {\n      if (user) {\n        const newToken = await user.getIdToken();\n        setToken(newToken);\n      } else {\n        setToken('');\n      }\n      setCurrentUser(user);\n      setLoading(false);\n    });\n  }, []);\n\n  const value = {\n    currentUser,\n    login,\n    loginWithGoogle,\n    signup,\n    logout,\n    resetPassword,\n    updateEmail,\n    updatePassword,\n    token,\n  };\n\n  return <AuthContext.Provider value={value}>{!loading && children}</AuthContext.Provider>;\n}\n\nAuthProvider.propTypes = {\n  children: PropTypes.node.isRequired,\n};\n"]},"metadata":{},"sourceType":"module"}